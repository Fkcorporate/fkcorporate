{% extends "base.html" %}
{% block title %}Créer un Gestionnaire d'Utilisateurs{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('dashboard') }}">Dashboard</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('client_admin_dashboard') }}">Admin Client</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('client_admin_utilisateurs') }}">Utilisateurs</a></li>
            <li class="breadcrumb-item active">Créer un gestionnaire</li>
        </ol>
    </nav>

    <div class="row">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-user-shield me-2"></i>Créer un Gestionnaire d'Utilisateurs
                    </h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-info mb-4">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Information :</strong> Les gestionnaires peuvent créer et gérer des utilisateurs, 
                        mais ne peuvent pas modifier les administrateurs client ni gérer les permissions.
                    </div>
                    
                    <!-- Statistiques -->
                    <div class="alert alert-warning">
                        <i class="fas fa-users me-2"></i>
                        <strong>Limites :</strong> {{ utilisateurs_actuels }}/{{ limite }} utilisateurs
                        <div class="progress mt-2" style="height: 8px;">
                            <div class="progress-bar 
                                {% if (utilisateurs_actuels/limite*100) >= 90 %}bg-danger
                                {% elif (utilisateurs_actuels/limite*100) >= 70 %}bg-warning
                                {% else %}bg-success{% endif %}" 
                                style="width: {{ (utilisateurs_actuels/limite*100) }}%">
                            </div>
                        </div>
                    </div>
                    
                    <form method="POST" action="">
                        {{ form.hidden_tag() }}
                        
                        <!-- Informations de base -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">{{ form.username.label }}</label>
                                {{ form.username(class="form-control", placeholder="ex: jean.manager") }}
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">{{ form.email.label }}</label>
                                {{ form.email(class="form-control", type="email", placeholder="ex: jean@entreprise.com") }}
                            </div>
                        </div>
                        
                        <!-- Mot de passe -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">{{ form.password.label }}</label>
                                {{ form.password(class="form-control", placeholder="Minimum 6 caractères") }}
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">{{ form.confirm_password.label }}</label>
                                {{ form.confirm_password(class="form-control", placeholder="Identique au mot de passe") }}
                            </div>
                        </div>
                        
                        <!-- Rôle -->
                        <div class="mb-3">
                            <label class="form-label">{{ form.role.label }}</label>
                            {{ form.role(class="form-select") }}
                            <small class="text-muted">
                                Le rôle définit les permissions métier (risques, audits, etc.)
                            </small>
                        </div>
                        
                        <!-- Permissions de gestion -->
                        <div class="card mb-3">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">Permissions de Gestion des Utilisateurs</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 mb-2">
                                        <div class="form-check form-switch">
                                            {{ form.can_view_users_list(class="form-check-input") }}
                                            <label class="form-check-label">{{ form.can_view_users_list.label.text }}</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <div class="form-check form-switch">
                                            {{ form.can_edit_users(class="form-check-input") }}
                                            <label class="form-check-label">{{ form.can_edit_users.label.text }}</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <div class="form-check form-switch">
                                            {{ form.can_create_users(class="form-check-input") }}
                                            <label class="form-check-label">{{ form.can_create_users.label.text }}</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <div class="form-check form-switch">
                                            {{ form.can_deactivate_users(class="form-check-input") }}
                                            <label class="form-check-label">{{ form.can_deactivate_users.label.text }}</label>
                                        </div>
                                    </div>
                                </div>
                                <small class="text-muted">
                                    Note : Les gestionnaires ne peuvent pas modifier les administrateurs client.
                                </small>
                            </div>
                        </div>
                        
                        <!-- Département -->
                        <div class="mb-3">
                            <label class="form-label">{{ form.department.label }}</label>
                            {{ form.department(class="form-control", placeholder="ex: Direction des Ressources Humaines") }}
                        </div>
                        
                        <!-- Statut -->
                        <div class="mb-4">
                            <div class="form-check">
                                {{ form.is_active(class="form-check-input") }}
                                <label class="form-check-label">{{ form.is_active.label.text }}</label>
                            </div>
                        </div>
                        
                        <!-- Boutons -->
                        <div class="d-flex justify-content-between">
                            <a href="{{ url_for('client_admin_utilisateurs') }}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left me-1"></i> Retour
                            </a>
                            {{ form.submit(class="btn btn-primary") }}
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Aide -->
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0">Guide du Gestionnaire</h6>
                </div>
                <div class="card-body">
                    <h6>Permissions accordées :</h6>
                    <ul class="small">
                        <li><i class="fas fa-check text-success me-1"></i>Voir la liste des utilisateurs</li>
                        <li><i class="fas fa-check text-success me-1"></i>Modifier les informations utilisateur</li>
                        <li><i class="fas fa-check text-success me-1"></i>Créer de nouveaux utilisateurs</li>
                        <li><i class="fas fa-check text-success me-1"></i>Activer/désactiver les comptes</li>
                    </ul>
                    
                    <h6 class="mt-3">Restrictions :</h6>
                    <ul class="small">
                        <li><i class="fas fa-times text-danger me-1"></i>Modifier les administrateurs client</li>
                        <li><i class="fas fa-times text-danger me-1"></i>Gérer les permissions avancées</li>
                        <li><i class="fas fa-times text-danger me-1"></i>Modifier les templates de permissions</li>
                        <li><i class="fas fa-times text-danger me-1"></i>Supprimer définitivement des utilisateurs</li>
                    </ul>
                    
                    <div class="alert alert-light mt-3">
                        <small>
                            <i class="fas fa-lightbulb me-1"></i>
                            <strong>Conseil :</strong> Attribuez le rôle de "Manager" pour donner accès 
                            à la gestion des risques et audits en plus de la gestion des utilisateurs.
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}